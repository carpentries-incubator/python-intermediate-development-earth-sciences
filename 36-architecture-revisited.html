<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Intermediate Research Software Development: 3.6 Architecture Revisited: Extending Software</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png"><link rel="manifest" href="favicons/incubator/site.webmanifest"><link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="assets/images/incubator-logo.svg"><span class="badge text-bg-info">
          <abbr title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
              Beta
            </a>
            <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/36-architecture-revisited.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Intermediate Research Software Development
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Intermediate Research Software Development
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="installation-instructions.html"></a></li><li><a class="dropdown-item" href="reference.html">Glossary</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Intermediate Research Software Development
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 67%" class="percentage">
    67%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 67%" aria-valuenow="67" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/36-architecture-revisited.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-setting-the-scene.html">1. Setting the Scene</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="10-section1-intro.html">2. Section 1: Setting Up Environment For Collaborative Code Development</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="11-software-project.html">3. 1.1 Introduction to Our Software Project</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="12-virtual-environments.html">4. 1.2 Virtual Environments For Software Development</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="13-ides.html">5. 1.3 Integrated Software Development Environments</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="14-collaboration-using-git.html">6. 1.4 Collaborative Software Development Using Git and GitHub</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="15-coding-conventions.html">7. 1.5 Python Code Style Conventions</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="16-verifying-code-style-linters.html">8. 1.6 Verifying Code Style Using Linters</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="20-section2-intro.html">9. Section 2: Ensuring Correctness of Software at Scale</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="21-automatically-testing-software.html">10. 2.1 Automatically Testing Software</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="22-scaling-up-unit-testing.html">11. 2.2 Scaling Up Unit Testing</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="23-continuous-integration-automated-testing.html">12. 2.3 Continuous Integration for Automated Testing</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="24-diagnosing-issues-improving-robustness.html">13. 2.4 Diagnosing Issues and Improving Robustness</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="30-section3-intro.html">14. Section 3: Software Development as a Process</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush16">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading16">
        <a href="31-software-requirements.html">15. 3.1 Software Requirements</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush17">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading17">
        <a href="32-software-design.html">16. 3.2 Software Architecture and Design</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush18">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading18">
        <a href="33-programming-paradigms.html">17. 3.3 Programming Paradigms</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush19">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading19">
        <a href="34-functional-programming.html">18. 3.4 Functional Programming</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush20">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading20">
        <a href="35-object-oriented-programming.html">19. 3.5 Object Oriented Programming</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        20. 3.6 Architecture Revisited: Extending Software
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#mvc-revisited">MVC Revisited</a></li>
<li><a href="#towards-collaborative-software-development">Towards Collaborative Software Development</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush22">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading22">
        <a href="40-section4-intro.html">21. Section 4: Collaborative Software Development for Reuse</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush23">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading23">
        <a href="41-code-review.html">22. 4.1 Developing Software In a Team: Code Review</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush24">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading24">
        <a href="42-software-reuse.html">23. 4.2 Preparing Software for Reuse and Release</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush25">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading25">
        <a href="43-software-release.html">24. 4.3 Packaging Code for Release and Distribution</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush26">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading26">
        <a href="50-section5-intro.html">25. Section 5: Managing and Improving Software Over Its Lifetime</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush27">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading27">
        <a href="51-managing-software.html">26. 5.1 Managing a Collaborative Software Project</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush28">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading28">
        <a href="52-assessing-software-suitability-improvement.html">27. 5.2 Assessing Software for Suitability and Improvement</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush29">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading29">
        <a href="53-improvement-through-feedback.html">28. 5.3 Software Improvement Through Feedback</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush30">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading30">
        <a href="60-wrap-up.html">29. Wrap-up</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="installation-instructions.html"></a></li><li><a href="reference.html">Glossary</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="35-object-oriented-programming.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="40-section4-intro.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="35-object-oriented-programming.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: 3.5 Object Oriented
        </a>
        <a class="chapter-link float-end" href="40-section4-intro.html" rel="next">
          Next: Section 4:...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>3.6 Architecture Revisited: Extending Software</h1>
        <p>Last updated on 2024-11-25 |

        <a href="https://github.com/carpentries-incubator/python-intermediate-development-earth-sciences/edit/main/episodes/36-architecture-revisited.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can we extend our software within the constraints of the MVC
architecture?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Extend our software to add a view of a single patient in the study
and the software’s command line interface to request a specific
view.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>As we have seen, we have different programming paradigms that are
suitable for different problems and affect the structure of our code. In
programming languages that support multiple paradigms, such as Python,
we have the luxury of using elements of different paradigms paradigms
and we, as software designers and programmers, can decide how to use
those elements in different architectural components of our software.
Let’s now circle back to the architecture of our software for one final
look.</p>
<section><h2 class="section-heading" id="mvc-revisited">MVC Revisited<a class="anchor" aria-label="anchor" href="#mvc-revisited"></a></h2>
<hr class="half-width"><p>We’ve been developing our software using the
<strong>Model-View-Controller</strong> (MVC) architecture so far, but,
as we have seen, MVC is just one of the common architectural patterns
and is not the only choice we could have made.</p>
<p>There are many variants of an MVC-like pattern (such as <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93presenter" class="external-link">Model-View-Presenter</a>
(MVP), <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel" class="external-link">Model-View-Viewmodel</a>
(MVVM), etc.), but in most cases, the distinction between these patterns
isn’t particularly important. What really matters is that we are making
decisions about the architecture of our software that suit the way in
which we expect to use it. We should reuse these established ideas where
we can, but we don’t need to stick to them exactly.</p>
<p>In this episode we’ll be taking our Object Oriented code from the
previous episode and integrating it into our existing MVC pattern. But
first we will explain some features of the Controller
(<code>catchment-analysis.py</code>) component of our architecture.</p>
<div class="section level3">
<h3 id="controller-file-structure">Controller file structure<a class="anchor" aria-label="anchor" href="#controller-file-structure"></a></h3>
<p>You will have noticed already that structure of the
<code>catchment-analysis.py</code> file follows this pattern:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># import modules</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="co"># perform some actions</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    <span class="co"># perform some actions before main()</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    main()</span></code></pre>
</div>
<p>In this pattern the actions performed by the script are contained
within the <code>main</code> function (which does not need to be called
<code>main</code>, but using this convention helps others in
understanding your code). The <code>main</code> function is then called
within the <code>if</code> statement
<code>__name__ == "__main__"</code>, after some other actions have been
performed (usually the parsing of command-line arguments, which will be
explained below). <code>__name__</code> is a special dunder variable
which is set, along with a number of other special dunder variables, by
the python interpreter before the execution of any code in the source
file. What value is given by the interpreter to <code>__name__</code> is
determined by the manner in which it is loaded.</p>
<p>If we run the source file directly using the Python interpreter,
e.g.:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">python</span> catchment-analysis.py</span></code></pre>
</div>
<p>then the interpreter will assign the hard-coded string
<code>"__main__"</code> to the <code>__name__</code> variable:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="va">__name__</span> <span class="op">=</span> <span class="st">"__main__"</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>...</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co"># rest of your code</span></span></code></pre>
</div>
<p>However, if your source file is imported by another Python script,
e.g:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> catchment<span class="op">-</span>analysis</span></code></pre>
</div>
<p>then the interpreter will assign the name
<code>"catchment-analysis"</code> from the import statement to the
<code>__name__</code> variable:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="va">__name__</span> <span class="op">=</span> <span class="st">"catchment-analysis"</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>...</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co"># rest of your code</span></span></code></pre>
</div>
<p>Because of this behaviour of the interpreter, we can put any code
that should only be executed when running the script directly within the
<code>if __name__ == "__main__":</code> structure, allowing the rest of
the code within the script to be safely imported by another script if we
so wish.</p>
<p>While it may not seem very useful to have your controller script
importable by another script, there are a number of situations in which
you would want to do this:</p>
<ul><li>for testing of your code, you can have your testing framework import
the main script, and run special test functions which then call the
<code>main</code> function directly;</li>
<li>where you want to not only be able to run your script from the
command-line, but also provide a programmer-friendly application
programming interface (API) for advanced users.</li>
</ul></div>
<div class="section level3">
<h3 id="passing-command-line-options-to-controller">Passing Command-line Options to Controller<a class="anchor" aria-label="anchor" href="#passing-command-line-options-to-controller"></a></h3>
<p>The standard python library for reading command line arguments passed
to a script is <a href="https://docs.python.org/3/library/argparse.html" class="external-link"><code>argparse</code></a>.
This module reads arguments passed by the system, and enables the
automatic generation of help and usage messages. These include, as we
saw at the start of this course, the generation of helpful error
messages when users give the program invalid arguments.</p>
<p>The basic usage of <code>argparse</code> can be seen in the
<code>catchment-analysis.py</code> script. First we import the
library:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">import</span> argparse</span></code></pre>
</div>
<p>We then initialise the argument parser class, passing an (optional)
description of the program:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    description<span class="op">=</span><span class="st">'A basic environmental data management system'</span>)</span></code></pre>
</div>
<p>Once the parser has been initialised we can add the arguments that we
want argparse to look out for. In our basic case, we want only the names
of the file(s) to process:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>parser.add_argument(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="st">'infiles'</span>,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    nargs<span class="op">=</span><span class="st">'+'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="bu">help</span><span class="op">=</span><span class="st">'Input CSV(s) containing measurement data'</span>)</span></code></pre>
</div>
<p>Here we have defined what the argument will be called
(<code>'infiles'</code>) when it is read in; the number of arguments to
be expected (<code>nargs='+'</code>, where <code>'+'</code> indicates
that there should be 1 or more arguments passed); and a help string for
the user
(<code>help='Input CSV(s) containing measurement data'</code>).</p>
<p>You can add as many arguments as you wish, and these can be either
mandatory (as the one above) or optional. Most of the complexity in
using <code>argparse</code> is in adding the correct argument options,
and we will explain how to do this in more detail below.</p>
<p>Finally we parse the arguments passed to the script using:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>args <span class="op">=</span> parser.parse_args()</span></code></pre>
</div>
<p>This returns an object (that we’ve called <code>arg</code>)
containing all the arguments requested. These can be accessed using the
names that we have defined for each argument,
e.g. <code>args.infiles</code> would return the filenames that have been
input.</p>
<p>The help for the script can be accessed using the <code>-h</code> or
<code>--help</code> optional argument (which <code>argparse</code>
includes by default):</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">python</span> catchment-analysis.py <span class="at">--help</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>usage: catchment-analysis.py [-h] infiles [infiles ...]

A basic environmental data management system

positional arguments:
  infiles     Input CSV(s) containing measurement data

optional arguments:
  -h, --help  show this help message and exit</code></pre>
</div>
<p>The help page starts with the command line usage, illustrating what
inputs can be given (any within <code>[]</code> brackets are optional).
It then lists the <strong>positional</strong> and
<strong>optional</strong> arguments, giving as detailed a description of
each as you have added to the <code>add_argument()</code> command.
Positional arguments are arguments that need to be included in the
proper position or order when calling the script.</p>
<p>Note that optional arguments are indicated by <code>-</code> or
<code>--</code>, followed by the argument name. Positional arguments are
simply inferred by their position. It is possible to have multiple
positional arguments, but usually this is only practical where all (or
all but one) positional arguments contains a clearly defined number of
elements. If more than one option can have an indeterminate number of
entries, then it is better to create them as ‘optional’ arguments. These
can be made a required input though, by setting
<code>required = True</code> within the <code>add_argument()</code>
command.</p>
<div id="positional-and-optional-argument-order" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="positional-and-optional-argument-order" class="callout-inner">
<h3 class="callout-title">Positional and Optional Argument Order</h3>
<div class="callout-content">
<p>The usage section of the help page above shows the optional arguments
going before the positional arguments. This is the customary way to
present options, but is not mandatory. Instead there are two rules which
must be followed for these arguments:</p>
<ol style="list-style-type: decimal"><li>Positional and optional arguments must each be given all together,
and not inter-mixed. For example, the order can be either
<code>optional - positional</code> or
<code>positional - optional</code>, but not
<code>optional - positional - optional</code>.</li>
<li>Positional arguments must be given in the order that they are shown
in the usage section of the help page.</li>
</ol></div>
</div>
</div>
<p>Now that you have some familiarity with <code>argparse</code>, we
will demonstrate below how you can use this to add extra functionality
to your controller.</p>
</div>
<div class="section level3">
<h3 id="choosing-the-measurement-dataseries">Choosing the Measurement Dataseries<a class="anchor" aria-label="anchor" href="#choosing-the-measurement-dataseries"></a></h3>
<p>Up until now we have only read the rainfall data from our
<code>data/rain_data_2015-12.csv</code> file. But what if we want to
read the river measurement data too? We can, simply, change the file
that we are reading, by passing a different file name. But when we do
this with the river data we get the following error:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">python</span> catchment-analysis.py data/river_data_2015-12.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Traceback (most recent call last):
  File "/Users/mbessdl2/work/manchester/Course_Material/Intermediate_Programming_Skills/python-intermediate-rivercatchment-template/catchment-analysis.py", line 39, in &lt;module&gt;
    main(args)
  File "/Users/mbessdl2/work/manchester/Course_Material/Intermediate_Programming_Skills/python-intermediate-rivercatchment-template/catchment-analysis.py", line 22, in main
    measurement_data = models.read_variable_from_csv(filename)
  File "/Users/mbessdl2/work/manchester/Course_Material/Intermediate_Programming_Skills/python-intermediate-rivercatchment-template/catchment/models.py", line 22, in read_variable_from_csv
    dataset = pd.read_csv(filename, usecols=['Date', 'Site', 'Rainfall (mm)'])
...
ValueError: Usecols do not match columns, columns expected but not found: ['Rainfall (mm)']</code></pre>
</div>
<p>This error message tells us that the pandas <code>read_csv</code>
function has failed to find one of the columns that are listed to be
read. We would not expect a column called <code>'Rainfall (mm)'</code>
in the river data file, so we need to make the
<code>read_variable_from_csv</code> more flexible, so that it can read
any defined measurement dataset.</p>
<p>The first step is to add an argument to our command line interface,
so that users can specify the measurement dataset. This can be done by
adding the following argument to your <code>catchment-analysis.py</code>
script:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>        <span class="st">'-m'</span>, <span class="st">'--measurements'</span>,</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>        <span class="bu">help</span> <span class="op">=</span> <span class="st">'Name of measurement data series to load'</span>,</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>        required <span class="op">=</span> <span class="va">True</span>)</span></code></pre>
</div>
<p>Here we have defined the name of the argument
(<code>--measurements</code>), as well as a short name (<code>-m</code>)
for lazy users to use. Note that the short name is preceded by a single
dash (<code>-</code>), while the full name is preceded by two dashes
(<code>--</code>). We provide a <code>help</code> string for the user,
and finally we set <code>required = True</code>, so that the end user
must define which data series they want to read.</p>
<p>Once this is added, then your help message should look like this:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">python</span> catchment-analysis.py <span class="at">--help</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>usage: catchment-analysis.py [-h] -m MEASUREMENTS infiles [infiles ...]

A basic environmental data management system

positional arguments:
  infiles               Input CSV(s) containing measurement data

optional arguments:
  -h, --help            show this help message and exit
  -m MEASUREMENTS, --measurements MEASUREMENTS
                        Name of measurement data series to use</code></pre>
</div>
<div id="optional-vs-required-arguments-and-argument-groups" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="optional-vs-required-arguments-and-argument-groups" class="callout-inner">
<h3 class="callout-title">Optional vs Required Arguments, and Argument Groups</h3>
<div class="callout-content">
<p>You will note that the <code>--measurements</code> argument is still
listed as an optional argument. This is because the two basic option
groups in <code>argparse</code> are positional and optional. In the
usage section the <code>--measurements</code> option is listed without
<code>[]</code> brackets, indicating that it is an expected argument,
but still this is not very clear for end users.</p>
<p>To make the help clearer we can add an extra argument group, and
assign <code>--measurements</code> to this:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>...</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>    req_group <span class="op">=</span> parser.add_argument_group(<span class="st">'required arguments'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>...</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>    req_group.add_argument(</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>        <span class="st">'-m'</span>, <span class="st">'--measurements'</span>,</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>        <span class="bu">help</span> <span class="op">=</span> <span class="st">'Name of measurement data series to load'</span>,</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>        required <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>...</span></code></pre>
</div>
<p>This will return the following help message:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">python</span> catchment-analysis.py <span class="at">--help</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>usage: catchment-analysis.py [-h] -m MEASUREMENTS infiles [infiles ...]

A basic environmental data management system

positional arguments:
  infiles               Input CSV(s) containing measurement data

optional arguments:
  -h, --help            show this help message and exit

required arguments:
  -m MEASUREMENTS, --measurements MEASUREMENTS
                        Name of measurement data series to use</code></pre>
</div>
<p>This solution is not perfect, because the positional arguments are
also required, but it will at least help end users distinguish between
optional and required flagged arguments.</p>
</div>
</div>
</div>
<div id="default-argument-number-and-type" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="default-argument-number-and-type" class="callout-inner">
<h3 class="callout-title">Default Argument Number and Type</h3>
<div class="callout-content">
<p><code>argparse</code> will, by default, assume that each argument
added will take a single value, and will be a string
(<code>type = str</code>). If you want to change this for any argument
you should explicitly set <code>type</code> and <code>nargs</code>.</p>
<p>Note also, that the returned object will be a single item unless
<code>nargs</code> has been set, in which case a list of items is
returned (even if <code>nargs = 1</code> is used).</p>
</div>
</div>
</div>
<div class="section level4">
<h4 id="controller-and-model-adaption">Controller and Model Adaption<a class="anchor" aria-label="anchor" href="#controller-and-model-adaption"></a></h4>
<p>The new measurement string needs to be passed to the
<code>read_variable_from_csv</code> function, and applied appropriately
within that function. First we add a <code>measurements</code> argument
to the <code>read_variable_from_csv</code> function in
<code>catchment/models.py</code> (remembering to update the function
docstring at the same time):</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># catchment/models.py</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>...</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="kw">def</span> read_variable_from_csv(filename, measurement):</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>    <span class="co">"""Reads a named variable from a CSV file, and returns a</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">    pandas dataframe containing that variable. The CSV file must contain</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">    a column of dates, a column of site ID's, and (one or more) columns</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">    of data - only one of which will be read.</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">    :param filename: Filename of CSV to load</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">    :param measurement: Name of data column to be read</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">    :return: 2D array of given variable. Index will be dates,</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">             Columns will be the individual sites</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>...</span></code></pre>
</div>
<p>Following this we need to change two lines of code, the first being
the CSV reading code, and the second being the code which reorganises
the dataset before it is returned:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># catchment/models.py</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>...</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="kw">def</span> read_variable_from_csv(filename, measurement):</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>...</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>    dataset <span class="op">=</span> pd.read_csv(filename, usecols<span class="op">=</span>[<span class="st">'Date'</span>, <span class="st">'Site'</span>, measurement])</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>...</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>    <span class="cf">for</span> site <span class="kw">in</span> dataset[<span class="st">'Site'</span>].unique():</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>        newdataset[site] <span class="op">=</span> dataset[dataset[<span class="st">'Site'</span>] <span class="op">==</span> site].set_index(<span class="st">'Date'</span>)[measurement]</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>...</span></code></pre>
</div>
<p>Finally, within the <code>main</code> function of the controller we
should add <code>args.measurements</code> as an argument:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># catchment-analysis.py</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>...</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="kw">def</span> main(args):</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>...</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>    <span class="cf">for</span> filename <span class="kw">in</span> in_files:</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>        measurement_data <span class="op">=</span> models.read_variable_from_csv(filename, args.measurements)</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>...</span></code></pre>
</div>
<p>You can now test your new code, to ensure it works as expected:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">python</span> catchment-analysis.py <span class="at">-m</span> <span class="st">'Rainfall (mm)'</span> data/rain_data_2015-12.csv</span></code></pre>
</div>
<figure><img src="fig/rainfall_daily_metrics.png" class="image-with-shadow figure mx-auto d-block" alt="Rainfall daily metrics" width="800"></figure><div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">python</span> catchment-analysis.py <span class="at">-m</span> <span class="st">'pH continuous'</span> data/river_data_2015-12.csv</span></code></pre>
</div>
<figure><img src="fig/pH_daily_metrics.png" class="image-with-shadow figure mx-auto d-block" alt="River pH daily metrics" width="800"></figure><p>Note that we have to use quotation marks to pass any strings which
contain spaces or special characters, so that they are properly read by
the parser.</p>
</div>
</div>
<div class="section level3">
<h3 id="adding-a-new-view">Adding a new View<a class="anchor" aria-label="anchor" href="#adding-a-new-view"></a></h3>
<p>Now that we can select the data we require, let’s add a view that
allows us to see the data for a single site. First, we need to add the
code for the view itself and make sure our <code>Site</code> class has
the necessary data - including the ability to pass a list of
measurements to the <code>__init__</code> method. Note that your Site
class may look very different now, so adapt this example to fit what you
have.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># file: catchment/views.py</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>...</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="kw">def</span> display_measurement_record(site):</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    <span class="co">"""Display each dataset for a single site."""</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>    <span class="bu">print</span>(site.name)</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>    <span class="cf">for</span> measurement <span class="kw">in</span> site.measurements:</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>        <span class="bu">print</span>(site.measurements[measurement].series)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># file: catchment/models.py</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>...</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="kw">class</span> MeasurementSeries:</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, series, name, units):</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>        <span class="va">self</span>.series <span class="op">=</span> series</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>        <span class="va">self</span>.units <span class="op">=</span> units</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>        <span class="va">self</span>.series.name <span class="op">=</span> <span class="va">self</span>.name</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>    </span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>    <span class="kw">def</span> add_measurement(<span class="va">self</span>, data):</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>        <span class="va">self</span>.series <span class="op">=</span> pd.concat([<span class="va">self</span>.series,data])</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>        <span class="va">self</span>.series.name <span class="op">=</span> <span class="va">self</span>.name</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>    </span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.units:</span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>units<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.name</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a><span class="kw">class</span> Location:</span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.name</span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a><span class="kw">class</span> Site(Location):</span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,name):</span>
<span id="cb26-31"><a href="#cb26-31" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(name)</span>
<span id="cb26-32"><a href="#cb26-32" tabindex="-1"></a>        <span class="va">self</span>.measurements <span class="op">=</span> {}</span>
<span id="cb26-33"><a href="#cb26-33" tabindex="-1"></a>    </span>
<span id="cb26-34"><a href="#cb26-34" tabindex="-1"></a>    <span class="kw">def</span> add_measurement(<span class="va">self</span>, measurement_id, data, units<span class="op">=</span><span class="va">None</span>):    </span>
<span id="cb26-35"><a href="#cb26-35" tabindex="-1"></a>        <span class="cf">if</span> measurement_id <span class="kw">in</span> <span class="va">self</span>.measurements.keys():</span>
<span id="cb26-36"><a href="#cb26-36" tabindex="-1"></a>            <span class="va">self</span>.measurements[measurement_id].add_measurement(data)</span>
<span id="cb26-37"><a href="#cb26-37" tabindex="-1"></a>    </span>
<span id="cb26-38"><a href="#cb26-38" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb26-39"><a href="#cb26-39" tabindex="-1"></a>            <span class="va">self</span>.measurements[measurement_id] <span class="op">=</span> MeasurementSeries(data, measurement_id, units)</span>
<span id="cb26-40"><a href="#cb26-40" tabindex="-1"></a>    </span>
<span id="cb26-41"><a href="#cb26-41" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb26-42"><a href="#cb26-42" tabindex="-1"></a>    <span class="kw">def</span> last_measurements(<span class="va">self</span>):</span>
<span id="cb26-43"><a href="#cb26-43" tabindex="-1"></a>        <span class="cf">return</span> pd.concat(</span>
<span id="cb26-44"><a href="#cb26-44" tabindex="-1"></a>            [<span class="va">self</span>.measurements[key].series[<span class="op">-</span><span class="dv">1</span>:] <span class="cf">for</span> key <span class="kw">in</span> <span class="va">self</span>.measurements.keys()],</span>
<span id="cb26-45"><a href="#cb26-45" tabindex="-1"></a>            axis<span class="op">=</span><span class="dv">1</span>).sort_index()</span></code></pre>
</div>
<p>Now we need to make sure people can call this view - that means
connecting it to the controller and ensuring that there’s a way to
request this view when running the program.</p>
<div class="section level4">
<h4 id="adapting-the-controller">Adapting the Controller<a class="anchor" aria-label="anchor" href="#adapting-the-controller"></a></h4>
<p>The changes we need to make here are that the <code>main</code>
function needs to be able to direct us to the view we’ve requested - and
we need to add to the command line interface - the controller - the
necessary data to drive the new view.</p>
<p>As the argument parsing routines are getting more involved, we have
moved these into a single function (<code>parse_cli_arguments</code>),
to make the script more readable.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># file: catchment-analysis.py</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="co">#!/usr/bin/env python3</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="co">"""Software for managing measurement data for our catchment project."""</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="im">from</span> catchment <span class="im">import</span> models, views</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="kw">def</span> main(args):</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>    <span class="co">"""The MVC Controller of the patient data system.</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a><span class="co">    The Controller is responsible for:</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a><span class="co">    - selecting the necessary models and views for the current task</span></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="co">    - passing data between models and views</span></span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>    infiles <span class="op">=</span> args.infiles</span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(infiles, <span class="bu">list</span>):</span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a>        infiles <span class="op">=</span> [args.infiles]</span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>    <span class="cf">for</span> filename <span class="kw">in</span> in_files:</span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a>        measurement_data <span class="op">=</span> models.read_variable_from_csv(filename, arg.measurements)</span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a></span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a>        <span class="co">### MODIFIED START </span><span class="al">###</span></span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a>        <span class="cf">if</span> args.view <span class="op">==</span> <span class="st">'visualize'</span>:</span>
<span id="cb27-28"><a href="#cb27-28" tabindex="-1"></a>            view_data <span class="op">=</span> {<span class="st">'daily sum'</span>: models.daily_total(measurement_data),</span>
<span id="cb27-29"><a href="#cb27-29" tabindex="-1"></a>                         <span class="st">'daily average'</span>: models.daily_mean(measurement_data),</span>
<span id="cb27-30"><a href="#cb27-30" tabindex="-1"></a>                         <span class="st">'daily max'</span>: models.daily_max(measurement_data),</span>
<span id="cb27-31"><a href="#cb27-31" tabindex="-1"></a>                         <span class="st">'daily min'</span>: models.daily_min(measurement_data)}</span>
<span id="cb27-32"><a href="#cb27-32" tabindex="-1"></a>        </span>
<span id="cb27-33"><a href="#cb27-33" tabindex="-1"></a>            views.visualize(view_data)</span>
<span id="cb27-34"><a href="#cb27-34" tabindex="-1"></a></span>
<span id="cb27-35"><a href="#cb27-35" tabindex="-1"></a>        <span class="cf">elif</span> args.view <span class="op">==</span> <span class="st">'record'</span>:</span>
<span id="cb27-36"><a href="#cb27-36" tabindex="-1"></a>            measurement_data <span class="op">=</span> measurement_data[args.site]</span>
<span id="cb27-37"><a href="#cb27-37" tabindex="-1"></a>            site <span class="op">=</span> models.Site(args.site)</span>
<span id="cb27-38"><a href="#cb27-38" tabindex="-1"></a>            site.add_measurement(arg.measurements, measurement_data)</span>
<span id="cb27-39"><a href="#cb27-39" tabindex="-1"></a></span>
<span id="cb27-40"><a href="#cb27-40" tabindex="-1"></a>            views.display_measurement_record(site)</span>
<span id="cb27-41"><a href="#cb27-41" tabindex="-1"></a>        <span class="co">### MODIFIED </span><span class="re">END</span><span class="co"> </span><span class="al">###</span></span>
<span id="cb27-42"><a href="#cb27-42" tabindex="-1"></a></span>
<span id="cb27-43"><a href="#cb27-43" tabindex="-1"></a></span>
<span id="cb27-44"><a href="#cb27-44" tabindex="-1"></a><span class="kw">def</span> parse_cli_arguments():</span>
<span id="cb27-45"><a href="#cb27-45" tabindex="-1"></a>    <span class="co">"""Definitions and logic tests for the CLI argument parser"""</span></span>
<span id="cb27-46"><a href="#cb27-46" tabindex="-1"></a>    </span>
<span id="cb27-47"><a href="#cb27-47" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb27-48"><a href="#cb27-48" tabindex="-1"></a>        description<span class="op">=</span><span class="st">'A basic environmental data management system'</span>)</span>
<span id="cb27-49"><a href="#cb27-49" tabindex="-1"></a>    </span>
<span id="cb27-50"><a href="#cb27-50" tabindex="-1"></a>    req_group <span class="op">=</span> parser.add_argument_group(<span class="st">'required arguments'</span>)</span>
<span id="cb27-51"><a href="#cb27-51" tabindex="-1"></a></span>
<span id="cb27-52"><a href="#cb27-52" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb27-53"><a href="#cb27-53" tabindex="-1"></a>        <span class="st">'infiles'</span>,</span>
<span id="cb27-54"><a href="#cb27-54" tabindex="-1"></a>        nargs <span class="op">=</span> <span class="st">'+'</span>,</span>
<span id="cb27-55"><a href="#cb27-55" tabindex="-1"></a>        <span class="bu">help</span> <span class="op">=</span> <span class="st">'Input CSV(s) containing measurement data'</span>)</span>
<span id="cb27-56"><a href="#cb27-56" tabindex="-1"></a></span>
<span id="cb27-57"><a href="#cb27-57" tabindex="-1"></a>    req_group.add_argument(</span>
<span id="cb27-58"><a href="#cb27-58" tabindex="-1"></a>        <span class="st">'-m'</span>, <span class="st">'--measurements'</span>,</span>
<span id="cb27-59"><a href="#cb27-59" tabindex="-1"></a>        <span class="bu">help</span> <span class="op">=</span> <span class="st">'Name of measurement data series to load'</span>,</span>
<span id="cb27-60"><a href="#cb27-60" tabindex="-1"></a>        required <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb27-61"><a href="#cb27-61" tabindex="-1"></a></span>
<span id="cb27-62"><a href="#cb27-62" tabindex="-1"></a>    <span class="co">### MODIFIED START </span><span class="al">###</span></span>
<span id="cb27-63"><a href="#cb27-63" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb27-64"><a href="#cb27-64" tabindex="-1"></a>        <span class="st">'--view'</span>,</span>
<span id="cb27-65"><a href="#cb27-65" tabindex="-1"></a>        default <span class="op">=</span> <span class="st">'visualize'</span>,</span>
<span id="cb27-66"><a href="#cb27-66" tabindex="-1"></a>        choices <span class="op">=</span> [<span class="st">'visualize'</span>, <span class="st">'record'</span>],</span>
<span id="cb27-67"><a href="#cb27-67" tabindex="-1"></a>        <span class="bu">help</span> <span class="op">=</span> <span class="st">'Which view should be used?'</span>)</span>
<span id="cb27-68"><a href="#cb27-68" tabindex="-1"></a></span>
<span id="cb27-69"><a href="#cb27-69" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb27-70"><a href="#cb27-70" tabindex="-1"></a>        <span class="st">'--site'</span>,</span>
<span id="cb27-71"><a href="#cb27-71" tabindex="-1"></a>        <span class="bu">type</span> <span class="op">=</span> <span class="bu">str</span>,</span>
<span id="cb27-72"><a href="#cb27-72" tabindex="-1"></a>        default <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb27-73"><a href="#cb27-73" tabindex="-1"></a>        <span class="bu">help</span> <span class="op">=</span> <span class="st">'Which site should be displayed?'</span>)</span>
<span id="cb27-74"><a href="#cb27-74" tabindex="-1"></a>    <span class="co">### MODIFIED </span><span class="re">END</span><span class="co"> </span><span class="al">###</span></span>
<span id="cb27-75"><a href="#cb27-75" tabindex="-1"></a></span>
<span id="cb27-76"><a href="#cb27-76" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb27-77"><a href="#cb27-77" tabindex="-1"></a>    </span>
<span id="cb27-78"><a href="#cb27-78" tabindex="-1"></a>    <span class="cf">if</span> args.view <span class="op">==</span> <span class="st">'record'</span> <span class="kw">and</span> args.site <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb27-79"><a href="#cb27-79" tabindex="-1"></a>        parser.error(<span class="st">"'record' --view requires that --site is set"</span>)</span>
<span id="cb27-80"><a href="#cb27-80" tabindex="-1"></a></span>
<span id="cb27-81"><a href="#cb27-81" tabindex="-1"></a>    <span class="cf">return</span> args</span>
<span id="cb27-82"><a href="#cb27-82" tabindex="-1"></a></span>
<span id="cb27-83"><a href="#cb27-83" tabindex="-1"></a></span>
<span id="cb27-84"><a href="#cb27-84" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb27-85"><a href="#cb27-85" tabindex="-1"></a></span>
<span id="cb27-86"><a href="#cb27-86" tabindex="-1"></a>    args <span class="op">=</span> parse_cli_arguments()</span>
<span id="cb27-87"><a href="#cb27-87" tabindex="-1"></a></span>
<span id="cb27-88"><a href="#cb27-88" tabindex="-1"></a>    main(args)</span></code></pre>
</div>
<p>We’ve added two options to our command line interface here: one to
request a specific view (<code>--view</code>) and one for the site ID
that we want to lookup (<code>--site</code>). Note that both are
optional, but have <code>default</code> values if they are not set. For
the view option, the default is for the graphic <code>visualize</code>
view, and we have set a defined list of <code>choices</code> that users
are allowed to specify. For the site option the default value is
<code>None</code>. We have added an <code>if</code> statement after the
arguments are parsed, but before calling the <code>main</code> function,
to ensure that the site option is set if we are using the
<code>record</code> view, which will return an error using the
<code>parser.error</code> function:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">python3</span> catchment-analysis.py <span class="at">--view</span> record <span class="at">-m</span> <span class="st">'Rainfall (mm)'</span> data/rain_data_2015-12.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>usage: catchment-analysis.py [-h] -m MEASUREMENTS [--view {visualize,record}] [--site SITE] infiles [infiles ...]
catchment-analysis.py: error: 'record' --view requires that --site is set</code></pre>
</div>
<p>Because we used the <code>parser.error</code> function, the usage
information for the command is given, followed by the error message that
we have added.</p>
<p>We can now call our program with these extra arguments to see the
record for a single site:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">$</span> python3 catchment-analysis.py <span class="at">--view</span> record <span class="at">--site</span> FP35 <span class="at">-m</span> <span class="st">'Rainfall (mm)'</span> data/rain_data_2015-12.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>FP35
2005-12-01 00:00:00    0.0
2005-12-01 00:15:00    0.0
2005-12-01 00:30:00    0.0
2005-12-01 00:45:00    0.0
2005-12-01 01:00:00    0.0
                      ...
2005-12-31 22:45:00    0.2
2005-12-31 23:00:00    0.0
2005-12-31 23:15:00    0.2
2005-12-31 23:30:00    0.2
2005-12-31 23:45:00    0.0
Name: Rainfall, Length: 2976, dtype: float64</code></pre>
</div>
<p>For the full range of features that we have access to with
<code>argparse</code> see the <a href="https://docs.python.org/3/library/argparse.html?highlight=argparse#module-argparse" class="external-link">Python
module documentation</a>. Allowing the user to request a specific view
like this is a similar model to that used by the popular Python library
Click - if you find yourself needing to build more complex interfaces
than this, Click would be a good choice. You can find more information
in <a href="https://click.palletsprojects.com/" class="external-link">Click’s
documentation</a>.</p>
<div id="additional-material" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="additional-material" class="callout-inner">
<h3 class="callout-title">Additional Material</h3>
<div class="callout-content">
<p>Now that we’ve covered the basics of different programming paradigms
and how we can integrate them into our multi-layer architecture, there
are two optional extra episodes which you may find interesting.</p>
<p>Both episodes cover the persistence layer of software architectures
and methods of persistently storing data, but take different approaches.
The episode on <a href="persistence.html">persistence with JSON</a>
covers some more advanced concepts in Object Oriented Programming, while
the episode on <a href="databases.html">databases</a> starts to build
towards a true multilayer architecture, which would allow our software
to handle much larger quantities of data.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="towards-collaborative-software-development">Towards Collaborative Software Development<a class="anchor" aria-label="anchor" href="#towards-collaborative-software-development"></a></h2>
<hr class="half-width"><p>Having looked at some theoretical aspects of software design, we are
now circling back to implementing our software design and developing our
software to satisfy the requirements collaboratively in a team. At an
intermediate level of software development, there is a wealth of
practices that could be used, and applying suitable design and coding
practices is what separates an intermediate developer from someone who
has just started coding. The key for an intermediate developer is to
balance these concerns for each software project appropriately, and
employ design and development practices enough so that progress can be
made.</p>
<p>One practice that should always be considered, and has been shown to
be very effective in team-based software development, is that of
<em>code review</em>. Code reviews help to ensure the ‘good’ coding
standards are achieved and maintained within a team by having multiple
people have a look and comment on key code changes to see how they fit
within the codebase. Such reviews check the correctness of the new code,
test coverage, functionality changes, and confirm that they follow the
coding guides and best practices. Let’s have a look at some code review
techniques available to us.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>By breaking down our software into components with a single
responsibility, we avoid having to rewrite it all when requirements
change. Such components can be as small as a single function, or be a
software package in their own right.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="35-object-oriented-programming.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="40-section4-intro.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="35-object-oriented-programming.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: 3.5 Object Oriented
        </a>
        <a class="chapter-link float-end" href="40-section4-intro.html" rel="next">
          Next: Section 4:...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries-incubator/python-intermediate-development-earth-sciences/edit/main/episodes/36-architecture-revisited.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries-incubator/python-intermediate-development-earth-sciences/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/python-intermediate-development-earth-sciences/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/python-intermediate-development-earth-sciences/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:info@software.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.10" class="external-link">sandpaper (0.16.10)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.7" class="external-link">pegboard (0.7.7)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/python-intermediate-development-earth-sciences/36-architecture-revisited.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "3.6 Architecture Revisited: Extending Software",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/python-intermediate-development-earth-sciences/36-architecture-revisited.html",
  "identifier": "https://carpentries-incubator.github.io/python-intermediate-development-earth-sciences/36-architecture-revisited.html",
  "dateCreated": "2020-04-23",
  "dateModified": "2024-11-25",
  "datePublished": "2024-12-03"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

